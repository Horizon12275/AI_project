### 7-1 软件功能初步设想

1. 参照 OneNote 的功能与使用体验，用户的状态分为离线状态与在线状态，离线状态下的用户可以查看本地已经缓存在 app 中的日程，但不能查看云端未同步到本地的日程，离线状态下可以添加对应的新的日程（要实现这个的话、可能只能再加一个手动添加的方式了、因为现在的两种添加都是走 ai 的）、但是不会同步到云端。在线状态下云端的笔记会自动同步到本地，本地未同步的日程会同步到云端上去。（场景：多个手机、或者多端用同一个账号的时候、可以保证用户看到的数据一致性）

2. 要求用户第一次使用 app 的时候、先注册登录账号、然后之后不管在在线状态和离线状态都可以进行使用。

3. 后端软件如果要更新的话，要保证不停机更新、即用户仍然能够正常使用服务。（可以采用灰度更新、逐步更新的方式）同时前端 app 还有不同的前端版本、保证用户可以在不同前端版本下可以正常使用服务。（这里需要统计用户 app 的版本信息？存储到日志文件里面？）

4. 后端要进行日志的统计、具体：？？？需要进行哪些统计？？？还有 要监控什么、是不是用中间件的监控网页就可以了？？？感觉用户的 app 版本需要监控使用不同版本的情况。

5. 后端需要能够自我管理、能够自愈的云环境，如何做到？？？故障之后的恢复要及时、迅速

6. 数据库需要有备份（灾备方案），保证数据库中的用户存储在云端上的日程数据不丢失、即使数据库被恶意清空、也能够恢复到一个合理的快照版本进行恢复，同时这个自愈的时间还要短。

7. 后续优化：服务间采用消息队列的方式实现解耦，以应对高并发的情况

8. 要实现后端服务的可用性（可靠性）（优先）：多开几个进程、然后进行负载均衡。还有什么可以加的？？？同时也可以进行冗余备份、保证服务的可用性。

9. 服务降级：1、当用户的网络出现问题的时候，要保证用户的基本使用，比如用户可以查看本地的日程，可以手动添加（待完善界面），但是不能调用 ai 生成日程的功能。（通过用户本机的缓存解决）2、当对应的 ai 服务出现问题的时候如何解决？ 可以切换不同的 api 接口尽量保证服务的可用（比如 gpt4 的不行了、降级成 gpt3.5）。3、实在链接不上的时候、就提示用户网络问题、请检查网络。（这里可能需要有一个超时时间、超过这个时间就提示用户出现了网络问题）

10. redis 的一些具体应用，能否在我们的场景下提升性能？？？ 我还不是很了解

11. 小结一下：为了保证用户在不同设备上的日程信息的一致性、需要定时从云端服务器上进行读操作。这里的方案也许可以参考一下 OneNote 之类的实现方式。或者比如说，用户在一个设备上进行了修改，那么这个修改会被上传到云端，然后其他设备会定时从云端进行读取（客户端向云端发请求？），这样就可以保证用户在不同设备上的日程信息的一致性。然后写操作会在用户进行日程输入的时候进行，这个时候会先将云端返回的 ai 生成的日程的详细结果写入本地缓存，然后再上传到云端，这样可以保证用户在离线状态下也可以进行日程的输入（没有 ai）。（或者在在线的情况下、先在云端写、然后再拉取到本地缓存、缓存中的一切日程信息均以服务器上的为准、可能会出现覆盖的情况）

12. 应该不是所有数据都需要进行存储、可以进行选择、比如用户先前的输入信息、应该不需要存在数据库里，数据库里可能只需要存最终的日程信息。（但也不一定）

13. 各种用户数据已经在网络上通信的安全性。（通过 ssl 加密、在数据库中验证、在微服务框架中使用 security / JWT / o2Auth 鉴权管理）（调用 api gpt 造成用户隐私泄漏的问题如何解决？）
